#!/usr/bin/env sh
#-*-mode: Shell-script; coding: utf-8;-*-

type emacs > /dev/null 2>&1
if [[ $? == 0 ]]; then
  function ee
  {
    . ${HOME}/src/orb/orb.sh
    opl use emacs
    orb use emacs
  }

  function se
  {
    (
      ee
      if [[ $DEBUG != '' ]]; then
        emacs --daemon
      else
        emacs --daemon --debug-init
      fi
    )
  }

  function fe
  {
    procname=emacs
    [[ $ostype == 'osx' ]] && procname=Emacs
    pgrep ${procname} > /dev/null 2>&1
    return $?
  }

  function kte
  {
    procname=emacs
    [[ $ostype == 'osx' ]] && procname=Emacs
    echo "Killing ${procname} with TERM"
    pkill -TERM ${procname}
  }

  function kke
  {
    procname=emacs
    [[ $ostype == 'osx' ]] && procname=Emacs
    echo "Killing ${procname} with KILL"
    pkill -KILL ${procname}
  }

  function fqe
  {
    emacsclient -e "(kill-emacs)"
  }

  function qe
  {
    fe
    if [[ $? == 0 ]]; then
      emacsclient -t -e "(save-buffers-kill-emacs)(kill-emacs)"
    fi
    fe
    if [[ $? == 0 ]]; then
      echo "Warning! Daemon process didn't shutdown properly"
      kte
    fi
    fe
    if [[ $? == 0 ]]; then
      echo "What the shit, ok fine, sending KILL to the sucker."
      kke
    fi
  }

  function te
  {
    fe
    if [[ $? != 0 ]]; then
      se
      emacsclient -t -e "(menu-bar-mode -1)"
    fi
  }

  function oe
  {
    fe
    if [[ $? != 0 ]]; then
      se
      (cd $HOME\
        && emacsclient -n -c -e "(tool-bar-mode -1) (menu-bar-mode 1)")
    fi
  }
fi
